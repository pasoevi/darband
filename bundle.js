(()=>{"use strict";var e={424:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(645),i=n.n(o)()((function(e){return e[1]}));i.push([e.id,"html,\nbody {\n    border: 0;\n    margin: 0;\n    padding: 0;\n    height: 100%;\n}\n\n.container {\n    position: relative;\n    width: 95%;\n    height: 95%;\n}\n\n.container canvas, #game-ui {\n    position: absolute;\n    top: 0;\n    left: 0;\n}\n\n#game-ui {\n    display: none;\n    background-color: rgba(2, green, blue, 0.75);\n    width: 90%;\n    height: auto;\n    color: red;\n}\n\ncanvas {\n    outline: 1px solid white;\n}\n\nbody {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background-color: indigo;\n    text-align: center;\n}\n",""]);const r=i},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,o){"string"==typeof e&&(e=[[null,e,""]]);var i={};if(o)for(var r=0;r<this.length;r++){var s=this[r][0];null!=s&&(i[s]=!0)}for(var a=0;a<e.length;a++){var l=[].concat(e[a]);o&&i[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),t.push(l))}},t}},837:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});const o=n.p+"ed154dfad390b910057308a394fa740b.png"},548:(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var o=n(379),i=n.n(o),r=n(795),s=n.n(r),a=n(569),l=n.n(a),h=n(565),u=n.n(h),c=n(216),f=n.n(c),d=n(589),p=n.n(d),m=n(424),g={};g.styleTagTransform=p(),g.setAttributes=u(),g.insert=l().bind(null,"head"),g.domAPI=s(),g.insertStyleElement=f(),i()(m.Z,g);const v=m.Z&&m.Z.locals?m.Z.locals:void 0},379:e=>{var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var r={},s=[],a=0;a<e.length;a++){var l=e[a],h=o.base?l[0]+o.base:l[0],u=r[h]||0,c="".concat(h," ").concat(u);r[h]=u+1;var f=n(c),d={css:l[1],media:l[2],sourceMap:l[3]};-1!==f?(t[f].references++,t[f].updater(d)):t.push({identifier:c,updater:i(d,o),references:1}),s.push(c)}return s}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var r=o(e=e||[],i=i||{});return function(e){e=e||[];for(var s=0;s<r.length;s++){var a=n(r[s]);t[a].references--}for(var l=o(e,i),h=0;h<r.length;h++){var u=n(r[h]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}r=l}}},569:e=>{var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t),t}},565:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},795:e=>{e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o=n.css,i=n.media,r=n.sourceMap;i?e.setAttribute("media",i):e.removeAttribute("media"),r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(o,e)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},272:function(e,t,n){var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.WizardLife=t.Actor=t.ConfusionEffect=t.Effect=t.AI=t.Inventory=t.Life=void 0;var r=n(727),s=n(221),a=n(789),l=function(){function e(e,t,n,o){this.game=s.Game.getInstance(),this.hp=e,this.maxHp=t,this.defence=n,this.actor=o}return e.prototype.die=function(){this.hp=0,this.actor.getTile().monster=null,this.game.ui.msg(this.game,this.actor.getName()+" dies")},e.prototype.isAlive=function(){return this.hp>0},e.prototype.takeDamage=function(e,t,n,o){var i=t;if(!e||!this.isAlive())return i;o&&(i=o.power-this.defence),void 0!==n&&(i=n.reduce((function(e,t){return e+t.value}),i));var s=this.hp;return this.hp=Math.max(0,this.hp-i),this.hp<=0&&this.die(),this.game.ui.msg(this.game,e.getName()+" attacks "+this.actor.getName()+" for "+i+". Was "+s+" is "+this.hp,r.Colors.red),i},e.prototype.heal=function(e){return this.hp=Math.min(this.maxHp,this.hp+e),this.game.ui.msg(this.game,this.actor.name+" heals by "+e),e},e}();t.Life=l;var h=function(){function e(){this.game=s.Game.getInstance(),this.items=[]}return e.prototype.getCurrentWeapon=function(){return this.weapon},e.prototype.pickItem=function(e){this.items.push(e)},e}();t.Inventory=h;var u=function(){function e(e,t,n,o){void 0===t&&(t={}),void 0===n&&(n=[]),void 0===o&&(o=10),this.monster=e,this.attackCountThisTurn=0,this.pursuing=void 0,this.game=s.Game.getInstance(),this.skills=t,this.quests=n,this.xp=o,this.xpLevel=0,this.pursue(this.game.player)}return e.prototype.getSkills=function(){return this.skills},e.prototype.getQuests=function(){return this.quests},e.prototype.addQuest=function(e){this.quests.push(e)},e.prototype.act=function(){if(this.monster.stunned)return this.monster.stunned=!1,void this.game.ui.msg(this.game,this.monster.name+" is no longer stunned");this.towardPursuedActor()},e.prototype.pursue=function(e){this.pursuing=e},e.prototype.towardPursuedActor=function(){if(void 0!==this.pursuing){var e=this.monster.getAdjacentTiles();if((e=e.filter((function(e){var t=e.getActorsOnThis();return 0===t.length||t.filter((function(e){return e.isPlayer})).length>0}))).length>0){var t=this.pursuing.getTile();e.sort((function(e,n){return e.distance(t)-n.distance(t)}));var n=e[0];this.monster.tryMove(n.x-this.monster.tile.x,n.y-this.monster.tile.y)}}},e}();t.AI=u;var c=function(){function e(e,t,n,o){void 0===t&&(t=5),void 0===n&&(n=""),this.actor=e,this.turnsLeft=t,this.name=n,this.onExpired=o}return e.prototype.renderOnMap=function(){},e.prototype.renderOnUI=function(){},e.prototype.update=function(){this.turnsLeft-=1,this.turnsLeft<=0&&void 0!==this.onExpired&&this.onExpired()},e}();t.Effect=c;var f=function(e){function t(t){var n=e.call(this,t,5)||this;return n.oldAI=t.ai,n.onExpired=function(){t.ai=n.oldAI,t.game.ui.msg(t.game,t.name+" is no longer confused")},t.ai=new a.ConfusedAI(t,n.oldAI.skills,n.oldAI.getQuests()),t.game.ui.msg(t.game,t.name+" is now confused"),n}return i(t,e),t}(c);t.ConfusionEffect=f;var d=function(){function e(e,t,n,o,i,r){this.isPlayer=!1,this.stunned=!1,this.game=s.Game.getInstance(),this.tile=t,this.name=null!=e?e:"Unnamed monster",this.sprite=n,this.domains=r,this.lastMove={x:-1,y:0},this.effects=[],this.animation={offsetX:0,offsetY:0,effectCounter:0,shakeAmount:0,shakeX:0,shakeY:0},void 0!==o&&(this.life=o),void 0!==i&&(this.ai=i)}return e.prototype.getName=function(){return this.name},e.prototype.getTile=function(){return this.tile},e.prototype.addEffect=function(e){var t=new e(this);this.effects.push(t)},e.prototype.getDisplayX=function(){return this.tile.x+this.animation.offsetX},e.prototype.getDisplayY=function(){return this.tile.y+this.animation.offsetY},e.prototype.update=function(){this.game.ui.msg(this.game,this.name+" "+(this.stunned?"is":"is NOT")+" stunned"),this.ai&&this.ai.act();for(var e=this.effects.length-1;e>=0;e--){var t=this.effects[e];t.update(),t.turnsLeft<=0&&void 0!==t.onExpired&&this.effects.splice(e,1)}},e.prototype.draw=function(){void 0!==this.sprite&&this.game.renderer.drawSprite(this.sprite,this.getDisplayX(),this.getDisplayY(),this.game.animation),this.animation.offsetX-=Math.sign(this.animation.offsetX)*(1/8),this.animation.offsetY-=Math.sign(this.animation.offsetY)*(1/8)},e.prototype.getAdjacentTiles=function(){return this.game.getTile(this.tile.x,this.tile.y).getAdjacentPassableTiles()},e}();t.Actor=d;var p=function(e){function t(t,n){return void 0===n&&(n=200),e.call(this,n,n,3,t)||this}return i(t,e),t}(l);t.WizardLife=p},727:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.Texts=t.Items=t.Levels=t.Colors=t.Settings=t.ActorType=void 0;var o={wall:"#c3c3c3",floor:"#323232",fire:"#e25822",ice:"#a5f2f3",poison:"#45f12c",magic:"#8b008b",chaos:"#d40f0f",wealth:"#c6c6c6",gold_metallic:"#d4af37",gold_old:"#cfb53b",gold_yellow:"#ffdf00",red:"#ff0000",white:"#ffffff",black:"#000000",orange:"#aa8811",blue:"#0000FF",purple:"#440044"};t.Colors=o,t.ActorType={MONSTER:"monster",WEAPON:"weapon",POTION:"potion"},t.Levels=[{domain:"abstracts",levelID:0,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:1,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:2,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:3,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:4,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:5,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:6,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:7,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:8,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:9,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:10,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:11,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:12,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:13,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:14,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:15,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:16,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:17,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:18,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:19,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:20,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:21,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:22,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:23,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:24,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:25,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:26,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]}];var i,r=[{name:"dagger",ch:"_",col:"#dfd",speed:100,domains:[1,2,5,6]},{name:"long sword",ch:"}",col:"#2f9",speed:100,domains:[1,5,5,6]},{name:"knife",ch:"-",col:"#2f9",speed:100,domains:[1,4,5,6]},{name:"orc",ch:"+",col:"#2f9",speed:100,domains:[3,4,5,6]},{name:"orc",ch:"(",col:"#2f9",speed:100,domains:[3,4,5,6]},{name:"orc",ch:")",col:"#2f9",speed:100,domains:[3,4,5,6]},{name:"orc",ch:")",col:"#2f9",speed:100,domains:[3,4,5,6]},{name:"blue potion",ch:"_",col:o.blue,speed:100,domains:[1,3]},{name:"purple potion",ch:"_",col:o.purple,speed:100,domains:[2,3,4,5]}];t.Items=r,t.Texts={en:{quotes:["He who fights monsters must take care lest he thereby\nbecome a monster","Live for today, for tomorrow never comes.","Always watch and follow nature","Where many die there is no fear of death","Deceit sleeps with greed","There is nothing sinister in sorcery, only in the hearts of men.","Only he who wanders can find new paths.","Death answers before she is asked. ","The world needs more heroes.","Better unlearned and bright, than erudite and foolish.","Better go without healing, than call for an unskilled healer.","Skill is not a heavy load to carry.","Even the best climber may fall.","There is no death for the honorable, only a change of bodies.","Straight ahead is always shortest, but not always best.","The sky is no less blue only because the blind can not see it.","Death smiles at us all. All a man can do is to smile back.","Nowhere are there more hiding places than in the heart.","What is the use of running when we are not on the right track?","When men speak ill of you, live so that nobody will believe them.","Everything we hear is an opinion, not a fact. Everything we see is a perspective, not the truth.","Hope is the dreams of the man awake.","He who starts a fight had better do the fighting himself.","Do not cry before you are hurt.","Cowards may die many times before their deaths.","Fear the reckoning of those you have wronged.","He who becomes a sheep will be eaten by the wolf.","The art of living well and the art of dying well is one.","Heroism consists in hanging on one minute longer.","Men brave and generous live the best lives, seldom will they sorrow; then there are fools, afraid of everything, who grumble instead of giving."],poems:[]},ru:{quotes:["He who fights monsters must take care lest he thereby\nbecome a monster","Live for today, for tomorrow never comes.","Always watch and follow nature","Where many die there is no fear of death","Deceit sleeps with greed"],poems:[]}},function(e){e.MOVE_UP="MOVE_UP",e.MOVE_RIGHT="MOVE_RIGHT",e.MOVE_DOWN="MOVE_DOWN",e.MOVE_LEFT="MOVE_LEFT",e.PICK_ITEM="PICK_ITEM",e.DROP_ITEM="DROP_ITEM",e.DROP_LAST_ITEM="DROP_LAST_ITEM",e.QUAFF="QUAFF",e.OPEN_INVENTORY="OPEN_INVENTORY",e.WIELD="WIELD",e.UNWIELD="UNWIELD",e.THROW="THROW",e.INVOKE="INVOKE",e.PRAY="PRAY"}(i||(i={}));var s={programName:"darband",version:"0.0.1",debug:!0,test:!1,mapW:36,mapH:13,windowW:36,windowH:16,logHeight:8,msg:{x:5,y:0},game:{winLevel:0,startLevel:16},keybindings:(n={},n[i.MOVE_UP]="",n[i.MOVE_RIGHT]="",n[i.MOVE_DOWN]="",n[i.MOVE_LEFT]="",n[i.PICK_ITEM]="",n[i.DROP_ITEM]="",n[i.DROP_LAST_ITEM]="",n[i.QUAFF]="",n[i.OPEN_INVENTORY]="",n[i.WIELD]="",n[i.UNWIELD]="",n[i.THROW]="",n[i.INVOKE]="",n[i.PRAY]="",n)};t.Settings=s},221:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Game=void 0;var o=n(714),i=n(789),r=n(778),s=n(906),a=n(349),l=n(102),h=function(){function e(e){var t=this;this.player=null,this.tiles=[],this.monsters=[],this.items=[],this.levelID=0,this.maxLevelID=16,this.gameState="TITLE",this.renderer=e.renderingLibrary,this.ui=e.ui,this.history=new o.History,this.logging=e.logging,this.renderer.setOnRendererReady((function(){t.ui.renderTitleScreen(t),setInterval((function(){t.render()}),15)})),this.animation={offsetX:0,offsetY:0,shakeAmount:0,shakeX:0,effectSprite:void 0,effectCounter:0,shakeY:0,screenshake:function(){this.shakeAmount&&this.shakeAmount--;var e=Math.random()*Math.PI*2;this.shakeX=Math.round(Math.cos(e)*this.shakeAmount),this.shakeY=Math.round(Math.sin(e)*this.shakeAmount)}}}return e.getInstance=function(t){if(void 0===e.instance){if(void 0===t)throw new Error("getInstance needs to be passed the parameters when called for the fist time");e.instance=new e(t)}return e.instance},e.prototype.getRandomPassableTile=function(){return this.getRandomTile((function(e){return e.passable}))},e.prototype.getTiles=function(e){var t=l.flatten(this.tiles);return void 0===e?t:t.filter(e)},e.prototype.getPassableTiles=function(){return this.getTiles((function(e){return e.passable}))},e.prototype.setupInputHandlers=function(){var e=this,t=document.querySelector("html");if(null===t)throw Error("Please run the app in the browser environment");t.onkeydown=function(t){if("TITLE"===e.gameState)e.startGame();else if("DEAD"===e.gameState)e.ui.renderTitleScreen(e);else if("PLAYING"===e.gameState){if(void 0===e.player)return;switch(t.key){case"w":e.player.tryMove(0,-1);break;case"s":e.player.tryMove(0,1);break;case"a":e.player.tryMove(-1,0);break;case"d":e.player.tryMove(1,0);break;case"Enter":e.startLevel(e.levelID+1);break;case"c":s.spells.confuse(e.player,e.monsters[0]);break;case"ArrowUp":e.monsters[0].tryMove(0,-1);break;case"ArrowDown":e.monsters[0].tryMove(0,1);break;case"ArrowLeft":e.monsters[0].tryMove(-1,0);break;case"ArrowRight":e.monsters[0].tryMove(1,0)}}}},e.prototype.setupGame=function(){this.setupInputHandlers()},e.prototype.startGame=function(){this.gameState="PLAYING",this.startLevel(0)},e.prototype.startLevel=function(e){this.levelID=e,this.generateLevel()},e.prototype.generateLevel=function(){var e=this;l.tryTo("generate map",(function(){return e.generateTiles()===e.getRandomPassableTile().getConnectedTiles().length}));var t=this.getRandomPassableTile();if(this.player=new r.Player(t),this.monsters=this.generateMonsters(),this.levelID>0&&this.getRandomPassableTile().replace(a.StaircaseUp),this.levelID<this.maxLevelID){var n=this.getRandomPassableTile().replace(a.StaircaseDown);0===this.levelID&&(n.sprite=42)}},e.prototype.generateMonsters=function(){for(var e=[],t=0,n=[[i.Dragon,i.Man,i.Goblin,i.Snake,i.Kobold],[i.Dragon,i.Man,i.Goblin,i.Snake,i.Kobold],[i.Dragon,i.Man,i.Goblin,i.Snake,i.Kobold],[i.Kobold,i.Goblin],[i.Kobold,i.Goblin],[i.Dragon,i.Dragon,i.Wolf,i.Wolf,i.Man,i.Troll,i.Snake,i.Snake],[i.Kobold,i.Goblin],[i.Kobold,i.Goblin],[i.Kobold,i.Goblin],[i.Kobold,i.Goblin],[i.Kobold,i.Goblin],[i.Kobold,i.Goblin],[i.Kobold,i.Goblin],[i.Kobold,i.Goblin]][this.levelID];t<n.length;t++){var o=n[t];e.push(i.createMonster(o))}return e},e.prototype.renderTiles=function(){for(var e=this.renderer.options.numTiles,t=0;t<e;t++)for(var n=0;n<e;n++)this.getTile(t,n).draw()},e.prototype.renderMonsters=function(){for(var e=0,t=this.monsters;e<t.length;e++)t[e].draw()},e.prototype.generateTiles=function(){for(var e=0,t=[],n=this.renderer.options.numTiles,o=0;o<n;o++){t[o]=[];for(var i=0;i<n;i++)Math.random()<.3||!this.inBounds(o,i)?t[o][i]=new a.Wall(o,i):(t[o][i]=new a.Floor(o,i),e++)}return this.tiles=t,e},e.prototype.inBounds=function(e,t){var n=this.renderer.options.numTiles;return e>0&&t>0&&e<n-1&&t<n-1},e.prototype.getTile=function(e,t){return this.inBounds(e,t)?this.tiles[e][t]:new a.Wall(e,t)},e.prototype.tick=function(){for(var e,t=this.monsters.length-1;t>=0;t--)(null===(e=this.monsters[t].life)||void 0===e?void 0:e.isAlive())?this.monsters[t].update():this.monsters.splice(t,1);this.player.life.isAlive()||(this.gameState="DEAD")},e.prototype.render=function(){"PLAYING"!==this.gameState&&"DEAD"!==this.gameState||(this.renderer.clearScreen(),this.animation.screenshake&&this.animation.screenshake(),this.renderTiles(),this.renderMonsters(),this.player.draw(),this.ui.render(this))},e.prototype.getRandomTile=function(e){var t=l.flatten(this.tiles),n=void 0===e?t:t.filter(e);return n[l.randomRange(0,n.length-1)]},e}();t.Game=h},789:function(e,t,n){var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.ConfusedAI=t.ConsumerAI=t.SlowAI=t.MoveAndAttackAI=t.SimpleLife=t.createMonster=t.Snake=t.Dragon=t.Elf=t.Troll=t.Man=t.Dwarf=t.Wolf=t.Orc=t.Kobold=t.Goblin=t.Monster=void 0;var r=n(272),s=n(221),a=function(e){function t(t,n,o,i,r,s,a){void 0===r&&(r=100);var l=e.call(this,t,o,n)||this;return l.life=null!=s?s:new y(l,r),l.ai=null!=a?a:new b(l),l}return i(t,e),t.prototype.draw=function(){e.prototype.draw.call(this),this.drawHP()},t.prototype.drawHP=function(){var e,t,n,o,i=this.game.renderer.options.tileSize,r=i*((null!==(t=null===(e=this.life)||void 0===e?void 0:e.hp)&&void 0!==t?t:0)/(null!==(o=null===(n=this.life)||void 0===n?void 0:n.maxHp)&&void 0!==o?o:1)),s=i-r;this.game.renderer.drawRect("lime",this.getDisplayX()*i,this.getDisplayY()*i+i-2,r,2),this.game.renderer.drawRect("red",this.getDisplayX()*i+r,this.getDisplayY()*i+i-2,s,2)},t.prototype.tryMove=function(e,t){var n,o=this.tile.getNeighbor(e,t);return!!o.passable&&(this.lastMove={x:e,y:t},null===o.monster?this.move(o):this.isPlayer!==o.monster.isPlayer&&(void 0!==this.ai&&this.ai.attackCountThisTurn++,o.monster.stunned=!0,this.game.ui.msg(this.game,this.name+" stuns "+o.monster.name),null===(n=o.monster.life)||void 0===n||n.takeDamage(this,10,[]),this.animation.offsetX=(o.x-this.tile.x)/2,this.animation.offsetY=(o.y-this.tile.y)/2),!0)},t.prototype.move=function(e){this.game.ui.msg(this.game,this.name+" "+(this.isPlayer?"move":"moves")+" to "+e.x+", "+e.y);var t=this.getTile();t.monster=null,this.animation.offsetX=t.x-e.x,this.animation.offsetY=t.y-e.y,this.tile=e,e.monster=this},t}(r.Actor);t.Monster=a;var l=function(e){function t(t){return e.call(this,"goblin",12,t,[0,1,2],95)||this}return i(t,e),t}(a);t.Goblin=l;var h=function(e){function t(t){return e.call(this,"kobold",15,t,[0,1,2],125)||this}return i(t,e),t}(a);t.Kobold=h;var u=function(e){function t(t){return e.call(this,"orc",14,t,[0,1,2,3],115)||this}return i(t,e),t}(a);t.Orc=u;var c=function(e){function t(t){var n=e.call(this,"wolf",11,t,[0,1,2,3,4],95)||this;return n.ai=new T(n),n}return i(t,e),t}(a);t.Wolf=c;var f=function(e){function t(t){return e.call(this,"dwarf",19,t,[7,8,9,10,11,12],120)||this}return i(t,e),t}(a);t.Dwarf=f;var d=function(e){function t(t){return e.call(this,"man",16,t,[3,4,5],100)||this}return i(t,e),t}(a);t.Man=d;var p=function(e){function t(t){var n=e.call(this,"troll",17,t,[3,4],160)||this;return n.ai=new w(n),n}return i(t,e),t}(a);t.Troll=p;var m=function(e){function t(t){return e.call(this,"elf",18,t,[0,1,2],150)||this}return i(t,e),t}(a);t.Elf=m;var g=function(e){function t(t){var n=e.call(this,"dragon",3,t,[10,11,12,13,14,15],250,void 0)||this;return n.ai=new k(n),n}return i(t,e),t}(a);t.Dragon=g;var v=function(e){function t(t){return e.call(this,"snake",13,t,[7,8,9],15)||this}return i(t,e),t}(a);t.Snake=v,t.createMonster=function(e){return new e(s.Game.getInstance().getRandomPassableTile())};var y=function(e){function t(t,n){return void 0===n&&(n=100),e.call(this,n,n,2,t)||this}return i(t,e),t}(r.Life);t.SimpleLife=y;var b=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.act=function(){this.attackCountThisTurn=0,e.prototype.act.call(this),0===this.attackCountThisTurn&&e.prototype.act.call(this)},t}(r.AI);t.MoveAndAttackAI=b;var w=function(e){function t(t,n){void 0===n&&(n=5);var o=e.call(this,t)||this;return o.speed=n,o}return i(t,e),t.prototype.act=function(){var t=this.monster.stunned;e.prototype.act.call(this),t||(this.monster.stunned=!0,this.game.ui.msg(this.game,this.monster.name+" is stunned"))},t}(r.AI);t.SlowAI=w;var k=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.eat=function(e){var t,n;null===(t=e.life)||void 0===t||t.die();var o=this.monster.life.heal((null===(n=e.life)||void 0===n?void 0:n.maxHp)/2);return this.game.ui.msg(this.game,this.monster.name+" heals by "+o+" by eating "+e.name),this.game.animation.shakeAmount=5,o>0},t.prototype.act=function(){var t=this;if(e.prototype.act.call(this),this.monster.life.hp<.75*this.monster.life.maxHp){var n=this.game.monsters.filter((function(e){return void 0!==e.life&&e.life.maxHp<t.monster.life.maxHp/2})).sort((function(e,n){return e.tile.distance(t.monster.tile)-n.tile.distance(t.monster.tile)}));this.pursue(n[0]);var o=this.monster.tile.getAdjacentActors().filter((function(e){return void 0!==e.life&&e.life.maxHp<t.monster.life.maxHp/2}));o.length>0&&this.eat(o[0])}else this.pursue(this.game.player)},t}(r.AI);t.ConsumerAI=k;var T=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.act=function(){var e=this.monster.tile.getAdjacentPassableTiles();if(e.length>0){var t=e[0].x-this.monster.tile.x,n=e[0].y-this.monster.tile.y;this.monster.tryMove(t,n)}},t}(r.AI);t.ConfusedAI=T},778:function(e,t,n){var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.UninitializedPlayer=t.Player=void 0;var r=n(272),s=function(e){function t(t){var n=e.call(this,"You",0,t,[])||this;return n.life=new r.WizardLife(n,1e3),n.isPlayer=!0,n}return i(t,e),t.prototype.tryMove=function(t,n){return!!e.prototype.tryMove.call(this,t,n)&&(this.game.tick(),!0)},t}(n(789).Monster);t.Player=s;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(s);t.UninitializedPlayer=a},906:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.spells=void 0;var o=n(272),i=n(171);t.spells={blink:function(e){e.move(e.game.getRandomPassableTile())},quake:function(e){for(var t,n=e.game.tiles,o=0;o<n.length;o++)for(var i=0;i<n.length;i++){var r=e.tile;if(r.monster){var s=4-r.getAdjacentPassableTiles().length;null===(t=r.monster.life)||void 0===t||t.takeDamage(e,10*s,[])}}e.game.animation.shakeAmount=20},maelstrom:function(e){for(var t=e.game,n=0,o=t.monsters;n<o.length;n++)o[n].move(t.getRandomPassableTile())},mulligan:function(e){e.game.startLevel(e.game.levelID)},aura:function(e){for(var t,n,o=0,i=e.tile.getAdjacentNeighbors();o<i.length;o++){var r=i[o];r.setAnimationEffect(13),r.monster&&(null===(t=r.monster.life)||void 0===t||t.heal(5)),e.tile.setAnimationEffect(13),null===(n=e.life)||void 0===n||n.heal(5)}},dash:function(e){var t,n,o=e.tile;do{n=o.getNeighbor(e.lastMove.x,e.lastMove.y)}while(n.passable&&!n.monster);if(e.tile!==o){e.move(o);for(var r=0,s=o.getAdjacentNeighbors();r<s.length;r++){var a=s[r];a.monster&&(a.setAnimationEffect(i.Sprites.AURA),a.monster.stunned=!0,null===(t=a.monster.life)||void 0===t||t.takeDamage(e,10,[]))}}},confuse:function(e,t){void 0!==t.ai&&t.addEffect(o.ConfusionEffect)}}},349:function(e,t,n){var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.StaircaseDown=t.StaircaseUp=t.Staircase=t.Wall=t.Floor=t.Tile=void 0;var r=n(221),s=n(102),a=function(){function e(e,t,n,o,i,s){void 0===n&&(n=0),void 0===o&&(o=!0),void 0===i&&(i=null),this.x=e,this.y=t,this.sprite=n,this.passable=o,this.monster=i,this.animation=s,this.game=r.Game.getInstance()}return e.prototype.draw=function(){var e,t=this.game.renderer;t.drawSprite(this.sprite,this.x,this.y,this.game.animation),this.animation&&(null===(e=this.animation)||void 0===e?void 0:e.effectCounter)>0&&(this.animation.effectCounter--,t.setGlobalAlpha(this.animation.effectCounter/30),void 0!==this.animation.effectSprite&&t.drawSprite(this.animation.effectSprite,this.x,this.y),t.resetGlobalAlpha())},e.prototype.setAnimationEffect=function(e){this.animation&&(this.animation.effectSprite=e,this.animation.effectCounter=30)},e.prototype.getActorsOnThis=function(){var e=this;return this.game.monsters.filter((function(t){return t.tile.x===e.x&&t.tile.y===e.y}))},e.prototype.getNeighbor=function(e,t){return this.game.getTile(this.x+e,this.y+t)},e.prototype.getAdjacentNeighbors=function(){return s.shuffle([this.getNeighbor(0,-1),this.getNeighbor(0,1),this.getNeighbor(-1,0),this.getNeighbor(1,0)])},e.prototype.getAdjacentActors=function(){return this.getAdjacentNeighbors().filter((function(e){return null!==e.monster})).map((function(e){return e.monster}))},e.prototype.getAdjacentPassableTiles=function(){return this.getAdjacentNeighbors().filter((function(e){return e.passable}))},e.prototype.distance=function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},e.prototype.getConnectedTiles=function(){for(var e,t=[this],n=[this];n.length;){var o=null===(e=n.pop())||void 0===e?void 0:e.getAdjacentPassableTiles().filter((function(e){return!t.includes(e)}));t=t.concat(null!=o?o:[]),n=n.concat(null!=o?o:[])}return t},e.prototype.replace=function(e){return this.game.tiles[this.x][this.y]=new e(this.x,this.y),this.game.tiles[this.x][this.y]},e}();t.Tile=a;var l=function(e){function t(t,n){return e.call(this,t,n,32,!0)||this}return i(t,e),t}(a);t.Floor=l;var h=function(e){function t(t,n){return e.call(this,t,n,33,!1)||this}return i(t,e),t}(a);t.Wall=h;var u=function(e){function t(t,n,o,i){var r=e.call(this,t,n,o,!0)||this;return r.direction=i,r}return i(t,e),t}(a);t.Staircase=u;var c=function(e){function t(t,n,o){return void 0===o&&(o=44),e.call(this,t,n,o,"UP")||this}return i(t,e),t}(u);t.StaircaseUp=c;var f=function(e){function t(t,n,o){return void 0===o&&(o=43),e.call(this,t,n,o,"DOWN")||this}return i(t,e),t}(u);t.StaircaseDown=f},102:(e,t)=>{function n(e,t){return Math.floor(Math.random()*(t-e+1))+e}Object.defineProperty(t,"__esModule",{value:!0}),t.shuffle=t.tryTo=t.flatten=t.randomRange=void 0,t.randomRange=n,t.flatten=function(e,n){void 0===n&&(n=[]);for(var o=0,i=e.length;o<i;o++){var r=e[o];Array.isArray(r)?t.flatten(r,n):n.push(r)}return n},t.tryTo=function(e,t){for(var n=1e3;n>0;n--)if(t())return;throw"Timeout while trying to "+e},t.shuffle=function(e){for(var t,o,i=e.slice(),r=1;r<i.length;r++)o=n(0,r),t=i[r],i[r]=i[o],i[o]=t;return i}},714:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.History=void 0;var n=function(){function e(){this.messages=[]}return e.prototype.push=function(e){this.messages.push(e)},e}();t.History=n},171:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasDrawingLibrary=t.Sprites=void 0;var o,i=n(837);(o=t.Sprites||(t.Sprites={}))[o.AURA=13]="AURA";var r=function(){function e(e,t){var n;this.isRendererReady=!1;var o=document.createElement("canvas");o.id=e,document.body.appendChild(o),this.canvas=o;var i=this.canvas.getContext("2d");if(null===i)throw new Error("No matching drawing context supported");this.context=i,this.options=t,this.context.imageSmoothingEnabled=!1,this.onRendererReady=null!==(n=t.onRendererReady)&&void 0!==n?n:function(){};var r=t.tileSize,s=t.numTiles,a=t.uiWidth;o.width=r*(s+a),o.height=r*s,o.style.width=o.width+"px",o.style.height=o.height+"px",this.spritesheet=new Image,this.loadAssets()}return e.prototype.setOnRendererReady=function(e){this.isRendererReady?e():this.onRendererReady=e},e.prototype.loadAssets=function(){var e=this;this.spritesheet.src=i.default,this.spritesheet.onload=function(){e.isRendererReady=!0,e.onRendererReady()}},e.prototype.drawSprite=function(e,t,n,o){var i,r,s=this.context,a=this.options.tileSize,l=this.spritesheet.height/a,h=this.spritesheet.width/a,u=Math.floor(e/h)*a,c=e%l*a;s.drawImage(this.spritesheet,c,u,a,a,t*a+(null!==(i=null==o?void 0:o.shakeX)&&void 0!==i?i:0),n*a+(null!==(r=null==o?void 0:o.shakeY)&&void 0!==r?r:0),a,a)},e.prototype.drawRect=function(e,t,n,o,i){void 0===o&&(o=this.canvas.width),void 0===i&&(i=this.canvas.height);var r=this.context,s=r.fillStyle;r.fillStyle=e,r.fillRect(t,n,o,i),r.fillStyle=s},e.prototype.drawText=function(e,t,n,o,i){var r;this.context.fillStyle=i,this.context.font=t+"px monospace",r=n?(this.canvas.width-this.context.measureText(e).width)/2:this.canvas.width-this.options.uiWidth*this.options.tileSize,this.context.fillText(e,r,o)},e.prototype.setGlobalAlpha=function(e){this.context.globalAlpha=e},e.prototype.resetGlobalAlpha=function(){this.setGlobalAlpha(1)},e.prototype.clearScreen=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},e}();t.CanvasDrawingLibrary=r},206:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConsoleLogging=void 0;var n=function(){function e(){}return e.prototype.log=function(e){console.log(e)},e}();t.ConsoleLogging=n},584:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasUI=void 0;var n=function(){function e(){}return e.prototype.msg=function(e,t,n){void 0===n&&(n="violet"),e.logging.log(t),e.renderer.drawText("Level: "+e.levelID,25,!1,40,n)},e.prototype.render=function(e){e.renderer.drawText("Level: "+e.levelID,25,!1,40,"violet")},e.prototype.renderTitleScreen=function(e){e.renderer.drawRect("rgba(0,0,0,.75)",0,0),e.gameState="TITLE",e.renderer.drawText("PRESS ANY KEY TO START",50,!0,500,"white")},e}();t.CanvasUI=n}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={id:o,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");o.length&&(e=o[o.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{n(548);var e,t=n(221),o=n(171),i=n(206),r=n(584);e={renderingLibrary:new o.CanvasDrawingLibrary("game",{tileSize:32,numTiles:19,uiWidth:4}),ui:new r.CanvasUI,logging:new i.ConsoleLogging},t.Game.getInstance(e).setupGame()})()})();