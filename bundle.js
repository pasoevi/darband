!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Game=void 0;var o=n(10),i=n(1),r=n(12),s=n(13),a=n(15),l=n(4),u=function(){function e(e){var t=this;this.player=null,this.tiles=[],this.monsters=[],this.items=[],this.levelID=0,this.maxLevelID=16,this.gameState="TITLE",this.renderer=e.renderingLibrary,this.ui=e.ui,this.history=new o.History,this.logging=e.logging,this.renderer.setOnRendererReady((function(){t.ui.renderTitleScreen(t),setInterval((function(){t.render()}),15)})),this.animation={offsetX:0,offsetY:0,shakeAmount:0,shakeX:0,effectSprite:void 0,effectCounter:0,shakeY:0,screenshake:function(){this.shakeAmount&&this.shakeAmount--;var e=Math.random()*Math.PI*2;this.shakeX=Math.round(Math.cos(e)*this.shakeAmount),this.shakeY=Math.round(Math.sin(e)*this.shakeAmount)}}}return e.getInstance=function(t){if(void 0===e.instance){if(void 0===t)throw new Error("getInstance needs to be passed the parameters when called for the fist time");e.instance=new e(t)}return e.instance},e.prototype.getRandomPassableTile=function(){return this.getRandomTile((function(e){return e.passable}))},e.prototype.getTiles=function(e){var t=l.flatten(this.tiles);return void 0===e?t:t.filter(e)},e.prototype.getPassableTiles=function(){return this.getTiles((function(e){return e.passable}))},e.prototype.setupInputHandlers=function(){var e=this,t=document.querySelector("html");if(null===t)throw Error("Please run the app in the browser environment");t.onkeydown=function(t){if("TITLE"===e.gameState)e.startGame();else if("DEAD"===e.gameState)e.ui.renderTitleScreen(e);else if("PLAYING"===e.gameState){if(void 0===e.player)return;switch(t.key){case"w":e.player.tryMove(0,-1);break;case"s":e.player.tryMove(0,1);break;case"a":e.player.tryMove(-1,0);break;case"d":e.player.tryMove(1,0);break;case"Enter":e.startLevel(e.levelID+1);break;case"c":s.spells.confuse(e.player,e.monsters[0]);break;case"ArrowUp":e.monsters[0].tryMove(0,-1);break;case"ArrowDown":e.monsters[0].tryMove(0,1);break;case"ArrowLeft":e.monsters[0].tryMove(-1,0);break;case"ArrowRight":e.monsters[0].tryMove(1,0)}}}},e.prototype.setupGame=function(){this.setupInputHandlers()},e.prototype.startGame=function(){this.gameState="PLAYING",this.startLevel(0)},e.prototype.startLevel=function(e){this.levelID=e,this.generateLevel()},e.prototype.generateLevel=function(){var e=this;l.tryTo("generate map",(function(){return e.generateTiles()===e.getRandomPassableTile().getConnectedTiles().length}));var t=this.getRandomPassableTile();if(this.player=new r.Player(t),this.monsters=this.generateMonsters(),this.levelID>0&&this.getRandomPassableTile().replace(a.StaircaseUp),this.levelID<this.maxLevelID){var n=this.getRandomPassableTile().replace(a.StaircaseDown);0===this.levelID&&(n.sprite=42)}},e.prototype.generateMonsters=function(){for(var e=[],t=0,n=[[i.Dragon,i.Man,i.Goblin,i.Snake,i.Kobold],[i.Dragon,i.Man,i.Goblin,i.Snake,i.Kobold],[i.Dragon,i.Man,i.Goblin,i.Snake,i.Kobold],[i.Kobold,i.Goblin],[i.Kobold,i.Goblin],[i.Dragon,i.Dragon,i.Wolf,i.Wolf,i.Man,i.Troll,i.Snake,i.Snake],[i.Kobold,i.Goblin],[i.Kobold,i.Goblin],[i.Kobold,i.Goblin],[i.Kobold,i.Goblin],[i.Kobold,i.Goblin],[i.Kobold,i.Goblin],[i.Kobold,i.Goblin],[i.Kobold,i.Goblin]][this.levelID];t<n.length;t++){var o=n[t];e.push(i.createMonster(o))}return e},e.prototype.renderTiles=function(){for(var e=this.renderer.options.numTiles,t=0;t<e;t++)for(var n=0;n<e;n++)this.getTile(t,n).draw()},e.prototype.renderMonsters=function(){for(var e=0,t=this.monsters;e<t.length;e++){t[e].draw()}},e.prototype.generateTiles=function(){for(var e=0,t=[],n=this.renderer.options.numTiles,o=0;o<n;o++){t[o]=[];for(var i=0;i<n;i++)Math.random()<.3||!this.inBounds(o,i)?t[o][i]=new a.Wall(o,i):(t[o][i]=new a.Floor(o,i),e++)}return this.tiles=t,e},e.prototype.inBounds=function(e,t){var n=this.renderer.options.numTiles;return e>0&&t>0&&e<n-1&&t<n-1},e.prototype.getTile=function(e,t){return this.inBounds(e,t)?this.tiles[e][t]:new a.Wall(e,t)},e.prototype.tick=function(){for(var e,t=this.monsters.length-1;t>=0;t--)(null===(e=this.monsters[t].life)||void 0===e?void 0:e.isAlive())?this.monsters[t].update():this.monsters.splice(t,1);this.player.life.isAlive()||(this.gameState="DEAD")},e.prototype.render=function(){"PLAYING"!==this.gameState&&"DEAD"!==this.gameState||(this.renderer.clearScreen(),this.animation.screenshake&&this.animation.screenshake(),this.renderTiles(),this.renderMonsters(),this.player.draw(),this.ui.render(this))},e.prototype.getRandomTile=function(e){var t=l.flatten(this.tiles),n=void 0===e?t:t.filter(e);return n[l.randomRange(0,n.length-1)]},e}();t.Game=u},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.ConfusedAI=t.ConsumerAI=t.SlowAI=t.MoveAndAttackAI=t.SimpleLife=t.createMonster=t.Snake=t.Dragon=t.Elf=t.Troll=t.Man=t.Dwarf=t.Wolf=t.Orc=t.Kobold=t.Goblin=t.Monster=void 0;var r=n(2),s=n(0),a=function(e){function t(t,n,o,i,r,s,a){void 0===r&&(r=100);var l=e.call(this,t,o,n)||this;return l.life=null!=s?s:new y(l,r),l.ai=null!=a?a:new b(l),l}return i(t,e),t.prototype.draw=function(){e.prototype.draw.call(this),this.drawHP()},t.prototype.drawHP=function(){var e,t,n,o,i=this.game.renderer.options.tileSize,r=i*((null!==(t=null===(e=this.life)||void 0===e?void 0:e.hp)&&void 0!==t?t:0)/(null!==(o=null===(n=this.life)||void 0===n?void 0:n.maxHp)&&void 0!==o?o:1)),s=i-r;this.game.renderer.drawRect("lime",this.getDisplayX()*i,this.getDisplayY()*i+i-2,r,2),this.game.renderer.drawRect("red",this.getDisplayX()*i+r,this.getDisplayY()*i+i-2,s,2)},t.prototype.tryMove=function(e,t){var n,o=this.tile.getNeighbor(e,t);if(o.passable){if(this.lastMove={x:e,y:t},null===o.monster)this.move(o);else if(this.isPlayer!==o.monster.isPlayer){void 0!==this.ai&&this.ai.attackCountThisTurn++,o.monster.stunned=!0,this.game.ui.msg(this.game,this.name+" stuns "+o.monster.name);null===(n=o.monster.life)||void 0===n||n.takeDamage(this,10,[]),this.animation.offsetX=(o.x-this.tile.x)/2,this.animation.offsetY=(o.y-this.tile.y)/2}return!0}return!1},t.prototype.move=function(e){this.game.ui.msg(this.game,this.name+" "+(this.isPlayer?"move":"moves")+" to "+e.x+", "+e.y);var t=this.getTile();t.monster=null,this.animation.offsetX=t.x-e.x,this.animation.offsetY=t.y-e.y,this.tile=e,e.monster=this},t}(r.Actor);t.Monster=a;var l=function(e){function t(t){return e.call(this,"goblin",12,t,[0,1,2],95)||this}return i(t,e),t}(a);t.Goblin=l;var u=function(e){function t(t){return e.call(this,"kobold",15,t,[0,1,2],125)||this}return i(t,e),t}(a);t.Kobold=u;var c=function(e){function t(t){return e.call(this,"orc",14,t,[0,1,2,3],115)||this}return i(t,e),t}(a);t.Orc=c;var h=function(e){function t(t){var n=e.call(this,"wolf",11,t,[0,1,2,3,4],95)||this;return n.ai=new M(n),n}return i(t,e),t}(a);t.Wolf=h;var f=function(e){function t(t){return e.call(this,"dwarf",19,t,[7,8,9,10,11,12],120)||this}return i(t,e),t}(a);t.Dwarf=f;var d=function(e){function t(t){return e.call(this,"man",16,t,[3,4,5],100)||this}return i(t,e),t}(a);t.Man=d;var p=function(e){function t(t){var n=e.call(this,"troll",17,t,[3,4],160)||this;return n.ai=new w(n),n}return i(t,e),t}(a);t.Troll=p;var m=function(e){function t(t){return e.call(this,"elf",18,t,[0,1,2],150)||this}return i(t,e),t}(a);t.Elf=m;var g=function(e){function t(t){var n=e.call(this,"dragon",3,t,[10,11,12,13,14,15],250,void 0)||this;return n.ai=new k(n),n}return i(t,e),t}(a);t.Dragon=g;var v=function(e){function t(t){return e.call(this,"snake",13,t,[7,8,9],15)||this}return i(t,e),t}(a);t.Snake=v,t.createMonster=function(e){return new e(s.Game.getInstance().getRandomPassableTile())};var y=function(e){function t(t,n){return void 0===n&&(n=100),e.call(this,n,n,2,t)||this}return i(t,e),t}(r.Life);t.SimpleLife=y;var b=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.act=function(){this.attackCountThisTurn=0,e.prototype.act.call(this),0===this.attackCountThisTurn&&e.prototype.act.call(this)},t}(r.AI);t.MoveAndAttackAI=b;var w=function(e){function t(t,n){void 0===n&&(n=5);var o=e.call(this,t)||this;return o.speed=n,o}return i(t,e),t.prototype.act=function(){var t=this.monster.stunned;e.prototype.act.call(this),t||(this.monster.stunned=!0,this.game.ui.msg(this.game,this.monster.name+" is stunned"))},t}(r.AI);t.SlowAI=w;var k=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.eat=function(e){var t,n;null===(t=e.life)||void 0===t||t.die();var o=this.monster.life.heal((null===(n=e.life)||void 0===n?void 0:n.maxHp)/2);return this.game.ui.msg(this.game,this.monster.name+" heals by "+o+" by eating "+e.name),this.game.animation.shakeAmount=5,o>0},t.prototype.act=function(){var t=this;if(e.prototype.act.call(this),this.monster.life.hp<.75*this.monster.life.maxHp){var n=this.game.monsters.filter((function(e){return void 0!==e.life&&e.life.maxHp<t.monster.life.maxHp/2})).sort((function(e,n){return e.tile.distance(t.monster.tile)-n.tile.distance(t.monster.tile)}));this.pursue(n[0]);var o=this.monster.tile.getAdjacentActors().filter((function(e){return void 0!==e.life&&e.life.maxHp<t.monster.life.maxHp/2}));o.length>0&&this.eat(o[0])}else this.pursue(this.game.player)},t}(r.AI);t.ConsumerAI=k;var M=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.act=function(){var e=this.monster.tile.getAdjacentPassableTiles();if(e.length>0){var t=e[0].x-this.monster.tile.x,n=e[0].y-this.monster.tile.y;this.monster.tryMove(t,n)}},t}(r.AI);t.ConfusedAI=M},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.WizardLife=t.Actor=t.ConfusionEffect=t.Effect=t.AI=t.Inventory=t.Life=void 0;var r=n(11),s=n(0),a=n(1),l=function(){function e(e,t,n,o){this.game=s.Game.getInstance(),this.hp=e,this.maxHp=t,this.defence=n,this.actor=o}return e.prototype.die=function(){this.hp=0,this.actor.getTile().monster=null,this.game.ui.msg(this.game,this.actor.getName()+" dies")},e.prototype.isAlive=function(){return this.hp>0},e.prototype.takeDamage=function(e,t,n,o){var i=t;if(!e||!this.isAlive())return i;o&&(i=o.power-this.defence),void 0!==n&&(i=n.reduce((function(e,t){return e+t.value}),i));var s=this.hp;return this.hp=Math.max(0,this.hp-i),this.hp<=0&&this.die(),this.game.ui.msg(this.game,e.getName()+" attacks "+this.actor.getName()+" for "+i+". Was "+s+" is "+this.hp,r.Colors.red),i},e.prototype.heal=function(e){return this.hp=Math.min(this.maxHp,this.hp+e),this.game.ui.msg(this.game,this.actor.name+" heals by "+e),e},e}();t.Life=l;var u=function(){function e(){this.game=s.Game.getInstance(),this.items=[]}return e.prototype.getCurrentWeapon=function(){return this.weapon},e.prototype.pickItem=function(e){this.items.push(e)},e}();t.Inventory=u;!function(){function e(){}e.prototype.getName=function(){return"Some quest"}}();var c=function(){function e(e,t,n,o){void 0===t&&(t={}),void 0===n&&(n=[]),void 0===o&&(o=10),this.monster=e,this.attackCountThisTurn=0,this.pursuing=void 0,this.game=s.Game.getInstance(),this.skills=t,this.quests=n,this.xp=o,this.xpLevel=0,this.pursue(this.game.player)}return e.prototype.getSkills=function(){return this.skills},e.prototype.getQuests=function(){return this.quests},e.prototype.addQuest=function(e){this.quests.push(e)},e.prototype.act=function(){if(this.monster.stunned)return this.monster.stunned=!1,void this.game.ui.msg(this.game,this.monster.name+" is no longer stunned");this.towardPursuedActor()},e.prototype.pursue=function(e){this.pursuing=e},e.prototype.towardPursuedActor=function(){if(void 0!==this.pursuing){var e=this.monster.getAdjacentTiles();if((e=e.filter((function(e){var t=e.getActorsOnThis();return 0===t.length||t.filter((function(e){return e.isPlayer})).length>0}))).length>0){var t=this.pursuing.getTile();e.sort((function(e,n){return e.distance(t)-n.distance(t)}));var n=e[0];this.monster.tryMove(n.x-this.monster.tile.x,n.y-this.monster.tile.y)}}},e}();t.AI=c;var h=function(){function e(e,t,n,o){void 0===t&&(t=5),void 0===n&&(n=""),this.actor=e,this.turnsLeft=t,this.name=n,this.onExpired=o}return e.prototype.renderOnMap=function(){},e.prototype.renderOnUI=function(){},e.prototype.update=function(){this.turnsLeft-=1,this.turnsLeft<=0&&void 0!==this.onExpired&&this.onExpired()},e}();t.Effect=h;var f=function(e){function t(t){var n=e.call(this,t,5)||this;return n.oldAI=t.ai,n.onExpired=function(){t.ai=n.oldAI,t.game.ui.msg(t.game,t.name+" is no longer confused")},t.ai=new a.ConfusedAI(t,n.oldAI.skills,n.oldAI.getQuests()),t.game.ui.msg(t.game,t.name+" is now confused"),n}return i(t,e),t}(h);t.ConfusionEffect=f;var d=function(){function e(e,t,n,o,i,r){this.isPlayer=!1,this.stunned=!1,this.game=s.Game.getInstance(),this.tile=t,this.name=null!=e?e:"Unnamed monster",this.sprite=n,this.domains=r,this.lastMove={x:-1,y:0},this.effects=[],this.animation={offsetX:0,offsetY:0,effectCounter:0,shakeAmount:0,shakeX:0,shakeY:0},void 0!==o&&(this.life=o),void 0!==i&&(this.ai=i)}return e.prototype.getName=function(){return this.name},e.prototype.getTile=function(){return this.tile},e.prototype.addEffect=function(e){var t=new e(this);this.effects.push(t)},e.prototype.getDisplayX=function(){return this.tile.x+this.animation.offsetX},e.prototype.getDisplayY=function(){return this.tile.y+this.animation.offsetY},e.prototype.update=function(){this.game.ui.msg(this.game,this.name+" "+(this.stunned?"is":"is NOT")+" stunned"),this.ai&&this.ai.act();for(var e=this.effects.length-1;e>=0;e--){var t=this.effects[e];t.update(),t.turnsLeft<=0&&void 0!==t.onExpired&&this.effects.splice(e,1)}},e.prototype.draw=function(){void 0!==this.sprite&&this.game.renderer.drawSprite(this.sprite,this.getDisplayX(),this.getDisplayY(),this.game.animation),this.animation.offsetX-=Math.sign(this.animation.offsetX)*(1/8),this.animation.offsetY-=Math.sign(this.animation.offsetY)*(1/8)},e.prototype.getAdjacentTiles=function(){return this.game.getTile(this.tile.x,this.tile.y).getAdjacentPassableTiles()},e}();t.Actor=d;var p=function(e){function t(t,n){return void 0===n&&(n=200),e.call(this,n,n,3,t)||this}return i(t,e),t}(l);t.WizardLife=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasDrawingLibrary=t.Sprites=void 0;var o=n(14);!function(e){e[e.AURA=13]="AURA"}(t.Sprites||(t.Sprites={}));var i=function(){function e(e,t){var n;this.isRendererReady=!1;var o=document.createElement("canvas");o.id=e,document.body.appendChild(o),this.canvas=o;var i=this.canvas.getContext("2d");if(null===i)throw new Error("No matching drawing context supported");this.context=i,this.options=t,this.context.imageSmoothingEnabled=!1,this.onRendererReady=null!==(n=t.onRendererReady)&&void 0!==n?n:function(){};var r=t.tileSize,s=t.numTiles,a=t.uiWidth;o.width=r*(s+a),o.height=r*s,o.style.width=o.width+"px",o.style.height=o.height+"px",this.spritesheet=new Image,this.loadAssets()}return e.prototype.setOnRendererReady=function(e){this.isRendererReady?e():this.onRendererReady=e},e.prototype.loadAssets=function(){var e=this;this.spritesheet.src=o.default,this.spritesheet.onload=function(){e.isRendererReady=!0,e.onRendererReady()}},e.prototype.drawSprite=function(e,t,n,o){var i,r,s=this.context,a=this.options.tileSize,l=this.spritesheet.height/a,u=this.spritesheet.width/a,c=Math.floor(e/u)*a,h=e%l*a;s.drawImage(this.spritesheet,h,c,a,a,t*a+(null!==(i=null==o?void 0:o.shakeX)&&void 0!==i?i:0),n*a+(null!==(r=null==o?void 0:o.shakeY)&&void 0!==r?r:0),a,a)},e.prototype.drawRect=function(e,t,n,o,i){void 0===o&&(o=this.canvas.width),void 0===i&&(i=this.canvas.height);var r=this.context,s=r.fillStyle;r.fillStyle=e,r.fillRect(t,n,o,i),r.fillStyle=s},e.prototype.drawText=function(e,t,n,o,i){var r;this.context.fillStyle=i,this.context.font=t+"px monospace",r=n?(this.canvas.width-this.context.measureText(e).width)/2:this.canvas.width-this.options.uiWidth*this.options.tileSize,this.context.fillText(e,r,o)},e.prototype.setGlobalAlpha=function(e){this.context.globalAlpha=e},e.prototype.resetGlobalAlpha=function(){this.setGlobalAlpha(1)},e.prototype.clearScreen=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},e}();t.CanvasDrawingLibrary=i},function(e,t,n){"use strict";function o(e,t){return Math.floor(Math.random()*(t-e+1))+e}Object.defineProperty(t,"__esModule",{value:!0}),t.shuffle=t.tryTo=t.flatten=t.randomRange=void 0,t.randomRange=o,t.flatten=function(e,n){void 0===n&&(n=[]);for(var o=0,i=e.length;o<i;o++){var r=e[o];Array.isArray(r)?t.flatten(r,n):n.push(r)}return n},t.tryTo=function(e,t){for(var n=1e3;n>0;n--)if(t())return;throw"Timeout while trying to "+e},t.shuffle=function(e){for(var t,n,i=1;i<e.length;i++)n=o(0,i),t=e[i],e[i]=e[n],e[n]=t;return e}},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",o=e[3];if(!o)return n;if(t&&"function"==typeof btoa){var i=(s=o,a=btoa(unescape(encodeURIComponent(JSON.stringify(s)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(l," */")),r=o.sources.map((function(e){return"/*# sourceURL=".concat(o.sourceRoot||"").concat(e," */")}));return[n].concat(r).concat([i]).join("\n")}var s,a,l;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,o){"string"==typeof e&&(e=[[null,e,""]]);var i={};if(o)for(var r=0;r<this.length;r++){var s=this[r][0];null!=s&&(i[s]=!0)}for(var a=0;a<e.length;a++){var l=[].concat(e[a]);o&&i[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),t.push(l))}},t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(7);var o,i=n(0),r=n(3),s=n(16),a=n(17);o={renderingLibrary:new r.CanvasDrawingLibrary("game",{tileSize:32,numTiles:19,uiWidth:4}),ui:new a.CanvasUI,logging:new s.ConsoleLogging},i.Game.getInstance(o).setupGame()},function(e,t,n){var o=n(8),i=n(9);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var r={insert:"head",singleton:!1};o(i,r);e.exports=i.locals||{}},function(e,t,n){"use strict";var o,i=function(){return void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o},r=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),s=[];function a(e){for(var t=-1,n=0;n<s.length;n++)if(s[n].identifier===e){t=n;break}return t}function l(e,t){for(var n={},o=[],i=0;i<e.length;i++){var r=e[i],l=t.base?r[0]+t.base:r[0],u=n[l]||0,c="".concat(l," ").concat(u);n[l]=u+1;var h=a(c),f={css:r[1],media:r[2],sourceMap:r[3]};-1!==h?(s[h].references++,s[h].updater(f)):s.push({identifier:c,updater:g(f,t),references:1}),o.push(c)}return o}function u(e){var t=document.createElement("style"),o=e.attributes||{};if(void 0===o.nonce){var i=n.nc;i&&(o.nonce=i)}if(Object.keys(o).forEach((function(e){t.setAttribute(e,o[e])})),"function"==typeof e.insert)e.insert(t);else{var s=r(e.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(t)}return t}var c,h=(c=[],function(e,t){return c[e]=t,c.filter(Boolean).join("\n")});function f(e,t,n,o){var i=n?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(e.styleSheet)e.styleSheet.cssText=h(t,i);else{var r=document.createTextNode(i),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(r,s[t]):e.appendChild(r)}}function d(e,t,n){var o=n.css,i=n.media,r=n.sourceMap;if(i?e.setAttribute("media",i):e.removeAttribute("media"),r&&btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleSheet)e.styleSheet.cssText=o;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(o))}}var p=null,m=0;function g(e,t){var n,o,i;if(t.singleton){var r=m++;n=p||(p=u(t)),o=f.bind(null,n,r,!1),i=f.bind(null,n,r,!0)}else n=u(t),o=d.bind(null,n,t),i=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return o(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;o(e=t)}else i()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=i());var n=l(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var o=0;o<n.length;o++){var i=a(n[o]);s[i].references--}for(var r=l(e,t),u=0;u<n.length;u++){var c=a(n[u]);0===s[c].references&&(s[c].updater(),s.splice(c,1))}n=r}}}},function(e,t,n){"use strict";n.r(t);var o=n(5),i=n.n(o)()(!1);i.push([e.i,"html,\nbody {\n    border: 0;\n    margin: 0;\n    padding: 0;\n    height: 100%;\n}\n\n.container {\n    position: relative;\n    width: 95%;\n    height: 95%;\n}\n\n.container canvas, #game-ui {\n    position: absolute;\n    top: 0;\n    left: 0;\n}\n\n#game-ui {\n    display: none;\n    background-color: rgba(2, green, blue, 0.75);\n    width: 90%;\n    height: auto;\n    color: red;\n}\n\ncanvas {\n    outline: 1px solid white;\n}\n\nbody {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background-color: indigo;\n    text-align: center;\n}\n",""]),t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.History=void 0;var o=function(){function e(){this.messages=[]}return e.prototype.push=function(e){this.messages.push(e)},e}();t.History=o},function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.Texts=t.Items=t.Levels=t.Colors=t.Settings=t.ActorType=void 0;var i={wall:"#c3c3c3",floor:"#323232",fire:"#e25822",ice:"#a5f2f3",poison:"#45f12c",magic:"#8b008b",chaos:"#d40f0f",wealth:"#c6c6c6",gold_metallic:"#d4af37",gold_old:"#cfb53b",gold_yellow:"#ffdf00",red:"#ff0000",white:"#ffffff",black:"#000000",orange:"#aa8811",blue:"#0000FF",purple:"#440044"};t.Colors=i,t.ActorType={MONSTER:"monster",WEAPON:"weapon",POTION:"potion"};t.Levels=[{domain:"abstracts",levelID:0,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:1,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:2,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:3,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:4,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:5,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:6,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:7,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:8,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:9,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:10,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:11,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:12,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"dungeons",levelID:13,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:14,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:15,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:16,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:17,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:18,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:19,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:20,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:21,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:22,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:23,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:24,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:25,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]},{domain:"gates",levelID:26,possibleMonsters:["goblin","kobold","orc","dwarf","man","troll","elf","dragon","snake"]}];var r=[{name:"dagger",ch:"_",col:"#dfd",speed:100,domains:[1,2,5,6]},{name:"long sword",ch:"}",col:"#2f9",speed:100,domains:[1,5,5,6]},{name:"knife",ch:"-",col:"#2f9",speed:100,domains:[1,4,5,6]},{name:"orc",ch:"+",col:"#2f9",speed:100,domains:[3,4,5,6]},{name:"orc",ch:"(",col:"#2f9",speed:100,domains:[3,4,5,6]},{name:"orc",ch:")",col:"#2f9",speed:100,domains:[3,4,5,6]},{name:"orc",ch:")",col:"#2f9",speed:100,domains:[3,4,5,6]},{name:"blue potion",ch:"_",col:i.blue,speed:100,domains:[1,3]},{name:"purple potion",ch:"_",col:i.purple,speed:100,domains:[2,3,4,5]}];t.Items=r;var s;t.Texts={en:{quotes:["He who fights monsters must take care lest he thereby\nbecome a monster","Live for today, for tomorrow never comes.","Always watch and follow nature","Where many die there is no fear of death","Deceit sleeps with greed","There is nothing sinister in sorcery, only in the hearts of men.","Only he who wanders can find new paths.","Death answers before she is asked. ","The world needs more heroes.","Better unlearned and bright, than erudite and foolish.","Better go without healing, than call for an unskilled healer.","Skill is not a heavy load to carry.","Even the best climber may fall.","There is no death for the honorable, only a change of bodies.","Straight ahead is always shortest, but not always best.","The sky is no less blue only because the blind can not see it.","Death smiles at us all. All a man can do is to smile back.","Nowhere are there more hiding places than in the heart.","What is the use of running when we are not on the right track?","When men speak ill of you, live so that nobody will believe them.","Everything we hear is an opinion, not a fact. Everything we see is a perspective, not the truth.","Hope is the dreams of the man awake.","He who starts a fight had better do the fighting himself.","Do not cry before you are hurt.","Cowards may die many times before their deaths.","Fear the reckoning of those you have wronged.","He who becomes a sheep will be eaten by the wolf.","The art of living well and the art of dying well is one.","Heroism consists in hanging on one minute longer.","Men brave and generous live the best lives, seldom will they sorrow; then there are fools, afraid of everything, who grumble instead of giving."],poems:[]},ru:{quotes:["He who fights monsters must take care lest he thereby\nbecome a monster","Live for today, for tomorrow never comes.","Always watch and follow nature","Where many die there is no fear of death","Deceit sleeps with greed"],poems:[]}},function(e){e.MOVE_UP="MOVE_UP",e.MOVE_RIGHT="MOVE_RIGHT",e.MOVE_DOWN="MOVE_DOWN",e.MOVE_LEFT="MOVE_LEFT",e.PICK_ITEM="PICK_ITEM",e.DROP_ITEM="DROP_ITEM",e.DROP_LAST_ITEM="DROP_LAST_ITEM",e.QUAFF="QUAFF",e.OPEN_INVENTORY="OPEN_INVENTORY",e.WIELD="WIELD",e.UNWIELD="UNWIELD",e.THROW="THROW",e.INVOKE="INVOKE",e.PRAY="PRAY"}(s||(s={}));var a={programName:"darband",version:"0.0.1",debug:!0,test:!1,mapW:36,mapH:13,windowW:36,windowH:16,logHeight:8,msg:{x:5,y:0},game:{winLevel:0,startLevel:16},keybindings:(o={},o[s.MOVE_UP]="",o[s.MOVE_RIGHT]="",o[s.MOVE_DOWN]="",o[s.MOVE_LEFT]="",o[s.PICK_ITEM]="",o[s.DROP_ITEM]="",o[s.DROP_LAST_ITEM]="",o[s.QUAFF]="",o[s.OPEN_INVENTORY]="",o[s.WIELD]="",o[s.UNWIELD]="",o[s.THROW]="",o[s.INVOKE]="",o[s.PRAY]="",o)};t.Settings=a},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.UninitializedPlayer=t.Player=void 0;var r=n(2),s=function(e){function t(t){var n=e.call(this,"You",0,t,[])||this;return n.life=new r.WizardLife(n,1e3),n.isPlayer=!0,n}return i(t,e),t.prototype.tryMove=function(t,n){return!!e.prototype.tryMove.call(this,t,n)&&(this.game.tick(),!0)},t}(n(1).Monster);t.Player=s;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(s);t.UninitializedPlayer=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.spells=void 0;var o=n(2),i=n(3);t.spells={blink:function(e){e.move(e.game.getRandomPassableTile())},quake:function(e){for(var t,n=e.game.tiles,o=0;o<n.length;o++)for(var i=0;i<n.length;i++){var r=e.tile;if(r.monster){var s=4-r.getAdjacentPassableTiles().length;null===(t=r.monster.life)||void 0===t||t.takeDamage(e,10*s,[])}}e.game.animation.shakeAmount=20},maelstrom:function(e){for(var t=e.game,n=0,o=t.monsters;n<o.length;n++){o[n].move(t.getRandomPassableTile())}},mulligan:function(e){e.game.startLevel(e.game.levelID)},aura:function(e){for(var t,n,o=0,i=e.tile.getAdjacentNeighbors();o<i.length;o++){var r=i[o];r.setAnimationEffect(13),r.monster&&(null===(t=r.monster.life)||void 0===t||t.heal(5)),e.tile.setAnimationEffect(13),null===(n=e.life)||void 0===n||n.heal(5)}},dash:function(e){var t,n,o=e.tile;do{n=o.getNeighbor(e.lastMove.x,e.lastMove.y)}while(n.passable&&!n.monster);if(e.tile!==o){e.move(o);for(var r=0,s=o.getAdjacentNeighbors();r<s.length;r++){var a=s[r];a.monster&&(a.setAnimationEffect(i.Sprites.AURA),a.monster.stunned=!0,null===(t=a.monster.life)||void 0===t||t.takeDamage(e,10,[]))}}},confuse:function(e,t){void 0!==t.ai&&t.addEffect(o.ConfusionEffect)}}},function(e,t,n){"use strict";n.r(t),t.default=n.p+"ed154dfad390b910057308a394fa740b.png"},function(e,t,n){"use strict";var o,i=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.StaircaseDown=t.StaircaseUp=t.Staircase=t.Wall=t.Floor=t.Tile=void 0;var r=n(0),s=n(4),a=function(){function e(e,t,n,o,i,s){void 0===n&&(n=0),void 0===o&&(o=!0),void 0===i&&(i=null),this.x=e,this.y=t,this.sprite=n,this.passable=o,this.monster=i,this.animation=s,this.game=r.Game.getInstance()}return e.prototype.draw=function(){var e,t=this.game.renderer;t.drawSprite(this.sprite,this.x,this.y,this.game.animation),this.animation&&(null===(e=this.animation)||void 0===e?void 0:e.effectCounter)>0&&(this.animation.effectCounter--,t.setGlobalAlpha(this.animation.effectCounter/30),void 0!==this.animation.effectSprite&&t.drawSprite(this.animation.effectSprite,this.x,this.y),t.resetGlobalAlpha())},e.prototype.setAnimationEffect=function(e){this.animation&&(this.animation.effectSprite=e,this.animation.effectCounter=30)},e.prototype.getActorsOnThis=function(){var e=this;return this.game.monsters.filter((function(t){return t.tile.x===e.x&&t.tile.y===e.y}))},e.prototype.getNeighbor=function(e,t){return this.game.getTile(this.x+e,this.y+t)},e.prototype.getAdjacentNeighbors=function(){return s.shuffle([this.getNeighbor(0,-1),this.getNeighbor(0,1),this.getNeighbor(-1,0),this.getNeighbor(1,0)])},e.prototype.getAdjacentActors=function(){return this.getAdjacentNeighbors().filter((function(e){return null!==e.monster})).map((function(e){return e.monster}))},e.prototype.getAdjacentPassableTiles=function(){return this.getAdjacentNeighbors().filter((function(e){return e.passable}))},e.prototype.distance=function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},e.prototype.getConnectedTiles=function(){for(var e,t=[this],n=[this];n.length;){var o=null===(e=n.pop())||void 0===e?void 0:e.getAdjacentPassableTiles().filter((function(e){return!t.includes(e)}));t=t.concat(null!=o?o:[]),n=n.concat(null!=o?o:[])}return t},e.prototype.replace=function(e){return this.game.tiles[this.x][this.y]=new e(this.x,this.y),this.game.tiles[this.x][this.y]},e}();t.Tile=a;var l=function(e){function t(t,n){return e.call(this,t,n,32,!0)||this}return i(t,e),t}(a);t.Floor=l;var u=function(e){function t(t,n){return e.call(this,t,n,33,!1)||this}return i(t,e),t}(a);t.Wall=u;var c=function(e){function t(t,n,o,i){var r=e.call(this,t,n,o,!0)||this;return r.direction=i,r}return i(t,e),t}(a);t.Staircase=c;var h=function(e){function t(t,n,o){return void 0===o&&(o=44),e.call(this,t,n,o,"UP")||this}return i(t,e),t}(c);t.StaircaseUp=h;var f=function(e){function t(t,n,o){return void 0===o&&(o=43),e.call(this,t,n,o,"DOWN")||this}return i(t,e),t}(c);t.StaircaseDown=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConsoleLogging=void 0;var o=function(){function e(){}return e.prototype.log=function(e){console.log(e)},e}();t.ConsoleLogging=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasUI=void 0;var o=function(){function e(){}return e.prototype.msg=function(e,t,n){void 0===n&&(n="violet"),e.logging.log(t),e.renderer.drawText("Level: "+e.levelID,25,!1,40,n)},e.prototype.render=function(e){e.renderer.drawText("Level: "+e.levelID,25,!1,40,"violet")},e.prototype.renderTitleScreen=function(e){e.renderer.drawRect("rgba(0,0,0,.75)",0,0),e.gameState="TITLE",e.renderer.drawText("PRESS ANY KEY TO START",50,!0,500,"white")},e}();t.CanvasUI=o}]);